## 第3.3节  CSpace寻址

在执行系统调用时，线程通过提供其CSpace中一个地址来向内核指定要引用的能力。此地址指向调用方CSpace中的特定slot，该slot包含要引用的能力。

设计上CSpace允许稀疏配置[^1]，查找能力地址的过程必须高效。因此，CSpace被实现为*受保护的页表*[^2]。

如前所述，CSpace是CNode对象的有向图，每个CNode是一个slot表，其中每个slot可以是空的，也可以包含一个能力，该能力还可以引用另一个CNode。回想一下2.3节，CNode中的slot数量必须是2的幂次方大小。一个CNode被描述为有一个*基数*，基数作为2的幂就得到其大小，也就是说，如果一个CNode有2^k个slot，那么它的基数就是k。内核将线程CSpace的根CNode能力存储在线程的TCB中[^3]。从概念上讲，CNode能力不仅存储CNode内核数据结构的指针，而且还存储一个保护值，见第3.3.1节。

[^1]: 即CNode为稀疏数组，有的slot有值，有的为空，有效“元素”不连续。

[^2]: CSpace寻址与页表查找很相似，查找页表时虚拟地址分成几段分别索引各自页表，逐级寻址到物理地址所在项。

[^3]: 这样CSpace寻址就有了一个已知的出发点。