## 第6.4节  虚拟化

硬件虚拟化在特定的ARM和x86平台上得到了支持。接口通过一系列内核对象、引用和系统调用公开，允许用户利用硬件虚拟化特性。

硬件虚拟化允许线程执行指令和操作，就好像它在一个更高的特权级别上运行一样。由于更高的特权级别通常可以访问额外的机器寄存器和其他状态数据，所以引入了一个VCPU对象来存储这些状态。为简单起见，我们将这种虚拟化的高特权级别称为“来宾模式”。VCPU与TCB以一对一的关系绑定，以便为线程提供更高的特权模式运行能力。有关更详细的信息，请参阅以下ARM或x86部分。

VCPU对象还具有额外的、特定于体系结构的调用，用于操作这些额外的状态或硬件提供的其他虚拟化控制。将VCPU绑定到TCB只需要引用VCPU对象能力，而不是TCB[^1]。

一般来说，所提供的对象和调用是对底层硬件原语和操作最简化的抽象。因此，在使用这些对象时，需要对底层体系结构特定的硬件机制有深入的了解，后面的描述中假定了这种了解。

[^1]: TCB能力要通过IPC缓冲区的额外能力字段传递。
